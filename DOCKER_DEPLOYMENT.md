# Docker Deployment Guide

This guide provides instructions for building and running the application using Docker and Docker Compose. This is a good option for local development or for deploying to any platform that supports Docker containers.

## 1. Understanding the Docker Setup

The `docker/` directory contains all the necessary files to create container images for the frontend and backend services and to orchestrate them using Docker Compose.

-   **`Dockerfile.prod`**: Defines the multi-stage build process for the Node.js backend service. It installs dependencies, copies the source code, and creates a final, smaller image with only the necessary production artifacts.
-   **`Dockerfile.frontend`**: Defines the multi-stage build process for the React frontend. It uses Nginx to serve the static files generated by the Vite build process.
-   **`compose.prod.yml`**: The Docker Compose file for orchestrating the production environment. It defines the `backend` and `frontend` services, configures their builds, maps ports, and sets up networking.

## 2. Building and Running with Docker Compose

The `compose.prod.yml` file is configured to build the images and run the containers.

### Step 1: Create an Environment File

The backend service requires the same environment variables as mentioned in the Render deployment guide. Docker Compose can read these from an `.env` file placed in the root of the project.

Create a file named `.env` in the project's root directory and add the following, replacing the placeholder values with your actual credentials:

```
# .env file
# Required for Backend Service
S3_BUCKET_NAME=your-s3-bucket-name
S3_REGION=your-s3-bucket-region
S3_ENDPOINT=https://your-s3-endpoint.com
S3_ACCESS_KEY_ID=your-s3-access-key
S3_SECRET_ACCESS_KEY=your-s3-secret-key
SENTRY_DSN=your-sentry-dsn
OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=your-otlp-traces-endpoint
OTEL_EXPORTER_OTLP_TRACES_HEADERS=your-otlp-traces-headers
OTEL_SERVICE_NAME=micro-ops-backend

# This variable is used by compose.prod.yml to expose the frontend port
FRONTEND_PORT=3000
```

### Step 2: Run Docker Compose

Once the `.env` file is in place, you can build and start the services using the production compose file.

Open your terminal in the root of the project and run the following command:

```bash
docker-compose -f docker/compose.prod.yml up --build
```

-   `docker-compose -f docker/compose.prod.yml`: This specifies the production compose file.
-   `up`: This command builds, (re)creates, starts, and attaches to containers for a service.
-   `--build`: This flag forces Docker Compose to build the images before starting the containers.

After the command finishes, the application will be running:

-   The **frontend** will be accessible at [http://localhost:3000](http://localhost:3000) (or whichever port you set for `FRONTEND_PORT`).
-   The **backend** API will be running on port `8000` inside the Docker network and will be accessible by the frontend container.

To stop the services, you can press `Ctrl+C` in the terminal where Docker Compose is running, or run `docker-compose -f docker/compose.prod.yml down` from another terminal.
